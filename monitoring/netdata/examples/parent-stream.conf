# Example Netdata Parent Node stream.conf
# This configuration is for a parent node that:
# 1. Accepts streams from child nodes
# 2. Replicates data to/from other parent nodes
# Updated with official best practices

[stream]
    # Enable streaming to other parents for replication
    enabled = yes
    
    # List all other parent nodes on 10G network with SSL (exclude this node's IP)
    # For holly (192.168.11.2), this would be:
    destination = 192.168.11.3:19999:SSL 192.168.11.4:19999:SSL
    
    # For lloyd (192.168.11.3), this would be:
    # destination = 192.168.11.2:19999:SSL 192.168.11.4:19999:SSL
    
    # For mable (192.168.11.4), this would be:
    # destination = 192.168.11.2:19999:SSL 192.168.11.3:19999:SSL
    
    # Shared replication key between all parents (use uuidgen to generate)
    api key = GENERATE-UUID-WITH-UUIDGEN
    
    # Connection settings optimized for 10G network
    timeout seconds = 60
    buffer size bytes = 10485760  # 10MB for 10G network
    reconnect delay seconds = 5
    initial clock resync iterations = 60
    
    # Performance optimizations
    enable compression = yes
    buffer on failures = 30
    
    # Send everything for full replication
    send charts matching = *
    
    # SSL configuration for self-signed certificates
    ssl skip certificate verification = yes

# Configuration for accepting metrics from child nodes
# Generate UUID with: uuidgen
[GENERATE-UUID-FOR-CHILDREN]
    # Enable receiving streams with this API key
    enabled = yes
    
    # Allow connections from specific child IPs on 10G network
    # Using IP ranges for cleaner configuration
    allow from = 192.168.11.11-13 192.168.11.20-22
    
    # Store received metrics using dbengine
    db = dbengine
    
    # Enable health monitoring for child nodes
    health enabled = yes
    
    # Health monitoring configuration
    health enabled by default = auto
    postpone alarms on connect = 60s
    
    # Optional: Set custom retention for these streams
    # retention = 86400
    
    # Default memory mode for streaming metrics
    default memory mode = dbengine

# Configuration for accepting replication from other parents
# Use same UUID across all parents for replication
[GENERATE-UUID-FOR-REPLICATION]
    # Enable receiving streams with this API key
    enabled = yes
    
    # Allow connections from other parent nodes on 10G network
    # Include all parent IPs for circular replication
    allow from = 192.168.11.2-4
    
    # Store replicated metrics
    db = dbengine
    
    # Parents handle their own health monitoring
    health enabled = no
    
    # No alarm delays needed for parent replication
    postpone alarms on connect = 0
    
    # Default memory mode for replicated data
    default memory mode = dbengine

# Additional API keys for other groups of children can be added
# Example for nodes on different subnet (30.0/24)
# [GENERATE-UUID-FOR-OTHER-SUBNET]
#     enabled = yes
#     allow from = 192.168.30.0/24
#     db = dbengine
#     health enabled = yes
#     postpone alarms on connect = 60s

# Example for ephemeral nodes (auto-scaling, containers)
# [GENERATE-UUID-FOR-EPHEMERAL]
#     enabled = yes
#     allow from = 10.0.0.0/8
#     db = alloc  # Or ram for minimal storage
#     health enabled = no
#     default memory mode = ram