# Example Netdata Child Node stream.conf
# This configuration is for a child node that streams to parent nodes
# Updated with official best practices

[stream]
# Enable streaming to parent nodes
enabled = yes

# List all parent nodes on 10G network with SSL for high availability
# Child will connect to the first available parent and failover automatically
destination = 192.168.11.2:19999 192.168.11.3:19999 192.168.11.4:19999

# API key must match the one configured on parent nodes (use uuidgen)
api key =

# Connection settings optimized for 10G network
timeout = 1m
default port = 19999
buffer size bytes = 10485760 # 10MB for 10G network
reconnect delay = 5s
initial clock resync iterations = 60

# Performance optimizations
# enable compression = yes
# buffer on failures = 30 # Keep 30 seconds of data during disconnections

# Send all metrics to parents (customize as needed)
send charts matching = *

# SSL configuration for self-signed certificates
ssl skip certificate verification = yes

# --- Thin Mode Configuration (Optional) ---
# Uncomment these lines to run in thin mode (minimal resources)
# memory mode = ram  # or 'none' for streaming-only
# health enabled = no

# --- Selective Streaming (Optional) ---
# You can limit what metrics are sent to parents to reduce bandwidth
# Example: Only send essential metrics
# send charts matching = system.* cpu.* mem.* disk.* net.* apps.*
# Example: Exclude specific charts
# send charts matching = !*.docker* !*.libvirt* !users.* *
# Example: Exclude detailed process metrics
# send charts matching = !apps.* !groups.* *
# --- SSL/TLS Configuration ---
# SSL is already enabled in the destination above
# For production with proper certificates:
# ssl skip certificate verification = no
# CApath = /etc/ssl/certs/
# CAfile = /etc/ssl/certs/ca-certificates.crt
# --- Advanced Options ---
# Compression is already enabled above (reduces bandwidth 60-80%)
# For different streaming port
# default port = 19999
# Replication settings (for catching up after reconnection)
# seconds to replicate = 86400  # 24 hours
# replication period = 86400    # 24 hours
# --- Resource-Constrained Configuration ---
# For nodes with limited resources, also update netdata.conf:
# [ml]
#     enabled = no
# [health]
#     enabled = no
# [web]
#     mode = none  # Disable local dashboard